{% extends 'accounts/base.html' %}
{% load static %}
{% block details %}
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="space-y-2">
        <span class="hidden md:block text-2xl font-semibold capitalize">Profile Picture</span>
        <div class="flex flex-row items-center justify-start gap-2 md:gap-7">
            {% if client.image %}
            <img id="profile-preview" src="{{ client.image.url }}" alt=""
                class="rounded-full h-[36px] w-[36px] md:h-[73px] md:w-[73px]" />
            {% else %}
            <img id="profile-preview" src="" alt="" class="rounded-full h-[36px] w-[36px] md:h-[73px] md:w-[73px]" />
            {% endif %}
            <div class="flex flex-row items-center justify-between gap-x-3">
                <button id="update-image-btn" type="button"
                    class="text-xs md:text-base font-normal capitalize border-1 md:border-2 border-[#252C32] px-2 py-0.5 rounded-3xl md:px-3 md:py-1.5">
                    Update
                </button>
                <button id="remove-image-btn" type="button"
                    class="flex flex-row justify-start items-center gap-1 px-2 rounded-3xl md:px-3 md:py-1.5">
                    <span data-icon="trash" class="w-3 h-3 md:w-4 md:h-4 relative -top-0.5"></span>
                    <p class="text-xs md:text-base">Remove</p>
                </button>
            </div>
        </div>
    </div>
    <div class="h-[1px] bg-[#1e232933] w-full mt-5 md:mt-6"></div>
    <div class="grid md:grid-cols-2 gap-6 flex-1 mt-[30px]">
        {% for field in form %}
        {% if field.name == 'image' %}
        <div id="image-input" class="justify-start items-start w-[48%] gap-1.5 hidden">
            {{ field }}
        </div>
        {% elif field.name == 'is_image_removed' %}
        <div id="is_image_removed" class="justify-start items-start w-[48%] gap-1.5 hidden">
            {{ field }}
        </div>
        {% else %}
        <div class="flex flex-col justify-start items-start w-full md:w-[48%] gap-1.5">
            <div class="flex flex-row items-center justify-between w-full">
                <span class="text-sm md:text-base font-medium capitalize">{{ field.label }}</span>
            </div>
            {{ field }}
        </div>
        {% endif %}
        {% endfor %}
    </div>
    <div class="flex flex-row md:flex-row-reverse items-center justify-between md:justify-start gap-x-[30px] md:gap-5 mt-9">
        <button type="submit" class="py-3 rounded-md px-9 bg-primary w-full md:w-max text-center">
            <span class="md:text-xl font-medium text-black capitalize">submit</span>
        </button>
        <a href="{% url 'profile' %}" class="py-3 border-2 rounded-md px-9 w-full md:w-max bg-[#EAECEF] text-center">
            <span class="md:text-xl font-medium capitalize">cancel</span>
        </a>
    </div>
    <div class="mt-4">
        {% for message in messages %}
        {% if message.tags == 'error' %}
        <p class="text-red-600">{{ message }}</p>
        {% endif %}
        {% endfor %}
    </div>
</form>
<script>
    var updateImageButton = document.getElementById('update-image-btn')
    var imageInput = document.querySelector('div#image-input > input');
    var imageViewer = document.getElementById('profile-preview');
    var imageDeleteButton = document.getElementById('remove-image-btn')
    var isImageDeleted = document.querySelector('div#is_image_removed > input');

    updateImageButton.addEventListener('click', function () {
        imageInput.click();
    });

    imageInput.addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            isImageDeleted.checked = false;
            const reader = new FileReader();
            reader.onload = function (e) {
                imageViewer.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    imageDeleteButton.addEventListener('click', function () {
        imageViewer.src = "";
        imageInput.value = "";
        isImageDeleted.checked = true;
    });
</script>
{% endblock %}